<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel - BCA Store</title>
<link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;700&display=swap" rel="stylesheet">
<style>
body { font-family:'Fira Code', monospace; margin:0; padding:0; background:#0f111a; color:#cfd8dc; }
header { background:#1f2233; padding:15px; text-align:center; color:#00ffcc; }
h1,h2 { margin:0; }
.container { padding:20px; }
table { width:100%; border-collapse:collapse; margin:15px 0; }
th,td { border:1px solid #22253b; padding:8px; text-align:left; }
th { background:#22253b; color:#00ffcc; }
tr:nth-child(even){background:#1a1c2b;}
.btn { background:#00ffcc; color:#0f111a; padding:6px 12px; border:none; border-radius:5px; cursor:pointer; }
.btn:hover { background:#00d6b2; }
input[type=password] { padding:10px; border-radius:6px; border:none; margin-top:15px; width:100%; max-width:250px; }
#loginSection { text-align:center; margin-top:100px; }
</style>
</head>
<body>

<div id="loginSection">
  <h1>Admin Login</h1>
  <input type="password" id="adminPass" placeholder="Enter Password">
  <button class="btn" onclick="checkLogin()">Login</button>
</div>

<div id="adminPanel" style="display:none;">
  <header>
    <h1>Admin Panel - BCA Store</h1>
    <p id="stats"></p>
  </header>
  <div class="container">
    <h2>Orders</h2>
    <table id="ordersTable">
      <thead><tr><th>Product</th><th>Name</th><th>Email</th><th>Mobile</th><th>Date</th><th>Action</th></tr></thead>
      <tbody></tbody>
    </table>

    <h2>Feedbacks</h2>
    <table id="feedbackTable">
      <thead><tr><th>Product</th><th>Feedback</th><th>Date</th><th>Action</th></tr></thead>
      <tbody></tbody>
    </table>

    <button class="btn" onclick="exportPDF()">Export All to PDF</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, getDocs, doc, deleteDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyBBV_jXIewP2OfcqYxtj2regQCicduc2fY",
  authDomain: "ount-32a16.firebaseapp.com",
  projectId: "ount-32a16",
  storageBucket: "ount-32a16.firebasestorage.app",
  messagingSenderId: "865150215832",
  appId: "1:865150215832:web:d6ab92c351584c71aa12ed"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const adminPassword = "Harsh@123";

function checkLogin(){
  const pass = document.getElementById("adminPass").value;
  if(pass===adminPassword){
    document.getElementById("loginSection").style.display="none";
    document.getElementById("adminPanel").style.display="block";
    loadAdminData();
  } else {
    alert("Incorrect Password!");
  }
}

// Load Orders & Feedback
async function loadAdminData(){
  // Stats
  const buyCountRef = doc(db,"storeInfo","buyCount");
  const visitorRef = doc(db,"storeInfo","visitorCount");
  const buySnap = await getDoc(buyCountRef);
  const visitorSnap = await getDoc(visitorRef);
  document.getElementById("stats").textContent = `Total Buys: ${buySnap.exists()?buySnap.data().total:0} | Visitors: ${visitorSnap.exists()?visitorSnap.data().total:0}`;

  // Orders
  const ordersCol = collection(db,"orders");
  const ordersSnapshot = await getDocs(ordersCol);
  const ordersTbody = document.querySelector("#ordersTable tbody");
  ordersTbody.innerHTML="";
  ordersSnapshot.forEach(docSnap=>{
    const data = docSnap.data();
    const row = document.createElement("tr");
    const date = data.time?.toDate()?.toLocaleString() || "";
    row.innerHTML=`<td>${data.product}</td><td>${data.name}</td><td>${data.email}</td><td>${data.mobile}</td><td>${date}</td>
      <td><button class="btn" onclick="deleteEntry('${docSnap.id}','orders')">Delete</button></td>`;
    ordersTbody.appendChild(row);
  });

  // Feedbacks
  const feedbackCol = collection(db,"feedbacks");
  const feedbackSnapshot = await getDocs(feedbackCol);
  const feedbackTbody = document.querySelector("#feedbackTable tbody");
  feedbackTbody.innerHTML="";
  feedbackSnapshot.forEach(docSnap=>{
    const data = docSnap.data();
    const date = data.time?.toDate()?.toLocaleString() || "";
    const row = document.createElement("tr");
    row.innerHTML=`<td>${data.product}</td><td>${data.feedback}</td><td>${date}</td>
      <td><button class="btn" onclick="deleteEntry('${docSnap.id}','feedbacks')">Delete</button></td>`;
    feedbackTbody.appendChild(row);
  });
}

// Delete Entry
window.deleteEntry = async function(id, collectionName){
  if(confirm("Are you sure you want to delete this entry?")){
    await deleteDoc(doc(db,collectionName,id));
    loadAdminData();
  }
}

// Export to PDF
window.exportPDF = function(){
  let html = "<h2>BCA Store Orders & Feedbacks</h2>";
  html+="<h3>Orders</h3>"+document.getElementById("ordersTable").outerHTML;
  html+="<h3>Feedbacks</h3>"+document.getElementById("feedbackTable").outerHTML;
  const newWin = window.open("","Print");
  newWin.document.write(html);
  newWin.document.close();
  newWin.print();
}
</script>
</body>
</html>
